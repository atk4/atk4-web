<?$Content?>

<div class="g-row" id="doc-ref">
	<div class="g-12">
        <h1>Debugging Models</h1>
        <p>An important thing about models you should understand, is that models on their own are here to serve 4 purposes:</p>
         <ul>
          <li>Produce dynamic SQL objects</li>
          <li>Load, hold and save a single record of data</li>
          <li>Contain meta-information for other views</li>
          <li>Perform business operations</li>
         </ul>
         <p>Some actions are more likely to go wrong, usually because of incorrectly defined fields.
        </p>

        <h3>Debugging produced SQL statement</h3>
        <p>You can switch on debug mode for any model by calling:
<?Code?>
$model->debug();
<?/?>

        <p>This will output queries as they are being generated by the underlying Dynamic SQL object(s). This method is good to see how dynamic SQL queries are being produced, and how data is being loaded, saved or otherwise accessed.</p>

        <h3>Get all data from model</h3>
        <p>You can see what's inside your model by calling var_dump($model->get()). This will output all the data saved in the model.</p>

        <h3>Transaction support</h3>
        <p>By default operations of a model are atomic, and it does not use SQL transactions. However, if you are using more complex operations, it's advisable for you to use transaction support:</p>

<?Code?>
class Model_Book extends Model_Table {
    
    // Skipped

    function addMultipleBooks($data){
        $this->api->db->beginTransaction();
        $this->unloadData();
        foreach($data as $row){
            $this->insert($data);
        }
        $this->api->db->commit();
    }
}
<?/?>

        <p>If error happens during inserts, an exception will bubble up through the call-stack and data will not be committed.</p>

        <h3>Adding more information to exceptions</h3>
        <p>In Agile Toolkit error reporting is implemented using Exceptions. To improve reporting you can intercept the exception add more information to it.</p>
<?Code?>
    function addMultipleBooks($data){
        $this->api->db->beginTransaction();
        $this->unloadData();
        try { 
            foreach($data as $row){
                $this->insert($data);
            }
        }catch(BasicException $e){
            throw $e->addMoreInfo('record_count',count(data));
        }
        $this->api->db->commit();
    }
<?/?>
        <p>Catching an exception will allow you to manipulate it - ie, by calling addMoreException(). This method returns "$this" - the exception  you are throwing again and which will be handled by the default application error handler - but your additional information will be included.</p>

        <h3>exception() method</h3>
        <p>Agile Toolkit defines the exception() method globally. Each model can define which exception class it uses, and the exception() function will return an instance of this class. This also allows for a more flexible syntax in the PHP code: throw $this->exception()->addMoreInfo(..)</p>
        <p>You can either redefine this method to add additional information - such as certain data from the model for exceptions which are being generated - or specify a different exception class through the $default_exception property.</p>

    </div>
</div>
<?$Next?>
